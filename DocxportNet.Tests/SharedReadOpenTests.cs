using DocxportNet.Visitors.PlainText;
using Xunit;
using Xunit.Sdk;

namespace DocxportNet.Tests;

public class SharedReadOpenTests
{
	private static readonly string ProjectRoot = Path.GetFullPath(Path.Combine(AppContext.BaseDirectory, "..", "..", "..", ".."));
	private static readonly string SamplesDirectory = Path.Combine(ProjectRoot, "samples");

	[Fact]
	public void Export_CanReadDocxWhileAnotherHandleIsOpen()
	{
		string docxPath = Path.Combine(SamplesDirectory, "sample-no-sectPr.docx");
		if (!File.Exists(docxPath))
			throw new XunitException($"Missing sample document at {docxPath}.");

		using var heldOpen = new FileStream(docxPath, FileMode.Open, FileAccess.Read, FileShare.Read);

		var visitor = new DxpPlainTextVisitor(DxpPlainTextVisitorConfig.CreateAcceptConfig());
		string output = DxpExport.ExportToString(docxPath, visitor);

		Assert.False(string.IsNullOrWhiteSpace(output));
	}
}

